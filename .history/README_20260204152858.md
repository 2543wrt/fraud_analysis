# Money Laundering Detection System

This project simulates and detects money laundering patterns in financial transactions using graph analysis and machine learning, adapted for the South African market (ZAR currency and FIC thresholds).

## Overview

The system generates synthetic transaction data containing both legitimate transactions and known money laundering patterns (like circular money flows, mule networks, and structuring). It then builds a network graph of these transactions to identify suspicious relationships and uses machine learning models to flag high-risk accounts.
The system generates synthetic transaction data containing both legitimate transactions and known money laundering patterns (like circular money flows, mule networks, and structuring). It then builds a network graph of these transactions (connecting to Neo4j for advanced visualization) to identify suspicious relationships and uses machine learning models to flag high-risk accounts.

## How It Works

1.  **Data Generation**: Creates fake accounts, devices, IP addresses, and transactions. It injects specific fraud patterns.
2.  **Graph Analysis**: Connects accounts based on money transfers and shared information (like using the same device). It looks for cycles (money going in a circle) and shared infrastructure.
3.  **Feature Extraction**: Calculates statistics for each account, such as total money sent/received, number of connections, and time between transactions.
4.  **Anomaly Detection**: Uses two machine learning models:
    - **Isolation Forest**: Finds statistical outliers (transactions that look very different from normal).
    - **Random Forest**: A supervised model trained to recognize specific fraud patterns.
5.  **Risk Scoring**: Combines the results to give every account and transaction a risk score.

## Project Structure

- `main.py`: The entry point script to run the analysis.
- `neo4j_connector.py`: Handles connection and data loading to Neo4j graph database.
- `src/`: Source code directory containing all modules.
  - `fraud_analysis.py`: The main analysis logic.
  - `data_generator.py`: Creates the synthetic dataset.
  - `transaction_graph.py`: Builds the network graph and finds circular flows.
  - `feature_extractor.py`: Turns graph data into numbers for the AI models.
  - `anomaly_detector.py`: Contains the machine learning logic.
  - `real_time_scorer.py`: Demonstrates how to score a single transaction instantly.
  - `visualization.py`: Generates charts and network diagrams.
  - `reporting.py`: Prints a summary report to the console.

## How to Run

1.  Ensure you have Python installed.
2.  Install the required libraries:
    ```bash
    pip install -r requirements.txt
    pip install neo4j  # Required for graph database integration
    ```
3.  **Run the Analysis**:

    _Standard Run (Synthetic Data):_

    ```bash
    python fraud_analysis.py
    ```

    _Run with Neo4j Integration:_

    ```bash
    python fraud_analysis.py --neo4j-uri neo4j+s://your-instance.databases.neo4j.io --neo4j-pass your_password
    ```

    _Run with Production Data:_

    ```bash
    python fraud_analysis.py --data data/daily_transactions.csv
    ```

4.  **Run the API**:
    ```bash
    python -m uvicorn src.api:app --reload
    ```

## Testing the API

You can test the running API using Postman:

1.  **Method**: POST
2.  **URL**: `http://127.0.0.1:8000/score`
3.  **Body** (Select "raw" and "JSON"):
    ```json
    {
      "from_account": "ACC_000001",
      "to_account": "ACC_000002",
      "amount": 24500.0,
      "device_id": "DEV_00001",
      "ip_address": "192.168.1.1"
    }
    ```

### Test Scenarios

**1. Legitimate Transaction (Low Risk)**

```json
{
  "from_account": "ACC_000001",
  "to_account": "ACC_000002",
  "amount": 2500.0,
  "device_id": "DEV_00001",
  "ip_address": "192.168.1.1"
}
```

**2. High Risk Transaction (Known High-Risk Account + Structuring)**
Use an account ID from your `risk_scores.csv` that has a high risk score (e.g., `ACC_000589`).

```json
{
  "from_account": "ACC_000589",
  "to_account": "ACC_000002",
  "amount": 9900.0,
  "device_id": "DEV_00001",
  "ip_address": "192.168.1.1"
}
```

## Outputs

After running the script, the system creates two folders:

- **generated_data/**: Contains `risk_scores.csv` with detailed risk metrics for every account.
- **generated_images/**: Contains visualizations:
  - `risk_analysis.png`: Charts showing risk distribution and feature importance.
  - `high_risk_network.png`: A visual diagram of the high-risk accounts and their connections.
